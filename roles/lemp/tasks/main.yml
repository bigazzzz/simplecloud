---

  - name: Install epel-release on CentOS
    yum:
      name: epel-release
      state: present
      update_cache: yes
    when: ansible_facts['distribution'] == "CentOS"

  - name: Install needed packages on CentOS
    yum:
      name: "{{ CentOS.packages }}"
      state: present
      update_cache: yes
    when: ansible_facts['distribution'] == "CentOS"

  - name: Install needed packages on Debian-based
    apt:
      name: "{{ Debian.packages }}"
      state: present
      update_cache: yes
      autoclean: yes
      autoremove: yes
    when: ansible_facts['os_family'] == "Debian"

  - name: Set nginx.conf
    template:
      src: nginx.conf.j2
      dest: /etc/nginx/nginx.conf
    notify:
      - restart nginx

  - name: Copy standart snippet for php site
    template:
      src: snippets/standart-sites.conf.j2
      dest: /etc/nginx/snippets/standart-sites.conf
    notify:
      - reload nginx

  - name: Copy default config
    template:
      src: default.conf.j2
      dest: /etc/nginx/sites-available/default

  - name: Enable default site
    file:
      src: /etc/nginx/sites-available/default
      dest: /etc/nginx/sites-enabled/default
      state: link
    notify:
      - reload nginx

  - name: Add phpinfo
    copy:
      src: index.php
      dest: /var/www/html/index.php
